--[[ Original Anti-Idle & Services ]]--

local VirtualUser = game:GetService('VirtualUser')

if game:GetService('Players').LocalPlayer then
    game:GetService('Players').LocalPlayer.Idled:Connect(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end)
end


--[[ Services ]]--

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService") -- Potrzebny do animacji UI
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")


--[[ Destroy Existing UI ]]--

-- Usuwamy stare wersje GUI, aby uniknąć konfliktów
local oldGui = PlayerGui:FindFirstChild("VenomHubScreenGui")
if oldGui then
    oldGui:Destroy()
end

local oldCategorizedGui = PlayerGui:FindFirstChild("VenomHubScreenGui_Categorized")
if oldCategorizedGui then
    oldCategorizedGui:Destroy()
end

local oldKeyGui = PlayerGui:FindFirstChild("KeyVerificationUI")
if oldKeyGui then
    oldKeyGui:Destroy()
end


-------------------------------------------------------------------------------
--  1. Tworzenie Głównego UI (Czytelne, Wieloliniowe)
-------------------------------------------------------------------------------

-- Główny kontener GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "VenomHubScreenGui_Categorized"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = PlayerGui

-- Ramka główna
local mainFrame = Instance.new("Frame")
mainFrame.Name = "VenomHubMainFrame"
mainFrame.Size = UDim2.new(0, 450, 0, 350) -- Dostosowany rozmiar
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20) -- Ciemne tło jak w drugim skrypcie
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true
mainFrame.Visible = true
mainFrame.Active = true
mainFrame.Draggable = false -- Wyłączymy standardowe przeciąganie, bo mamy własne
mainFrame.Parent = screenGui

-- Zaokrąglenie rogów ramki głównej
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = mainFrame

-- Obramowanie ramki głównej
local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(60, 60, 75) -- Obramowanie jak w drugim skrypcie
stroke.Thickness = 1
stroke.Transparency = 0.5
stroke.Parent = mainFrame

-- Tytuł
local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "Title"
titleLabel.Size = UDim2.new(1, -40, 0, 40) -- Dostosowany rozmiar tytułu
titleLabel.Position = UDim2.new(0, 20, 0, 5) -- Trochę niżej
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "EQR Hub v.1.19B"
titleLabel.Font = Enum.Font.GothamSemibold -- Font jak w drugim skrypcie
titleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
titleLabel.TextSize = 20 -- Rozmiar fontu
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = mainFrame

-- Linia pod tytułem
local line = Instance.new("Frame")
line.Name = "Divider"
line.Size = UDim2.new(1, -40, 0, 1)
line.Position = UDim2.new(0, 20, 0, 40) -- Pod tytułem
line.BackgroundColor3 = Color3.fromRGB(60, 60, 75)
line.BorderSizePixel = 0
line.Parent = mainFrame

-- Podpis (Footer)
local footerLabel = Instance.new("TextLabel")
footerLabel.Name = "Footer"
footerLabel.Size = UDim2.new(1, -20, 0, 20) -- Rozmiar i pozycja stopki
footerLabel.Position = UDim2.new(0, 10, 1, -25)
footerLabel.BackgroundTransparency = 1
footerLabel.Text = "By helloitsme#4243 | Press K to Toggle" -- Dodano info o K
footerLabel.Font = Enum.Font.Gotham -- Font jak w drugim skrypcie
footerLabel.TextSize = 10
footerLabel.TextColor3 = Color3.fromRGB(100, 100, 120)
footerLabel.TextXAlignment = Enum.TextXAlignment.Right
footerLabel.Parent = mainFrame

-- Sidebar na kategorie
local sidebarFrame = Instance.new("Frame")
sidebarFrame.Name = "SidebarFrame"
sidebarFrame.Size = UDim2.new(0, 120, 1, -70) -- Szerokość paska bocznego, wysokość dopasowana
sidebarFrame.Position = UDim2.new(0, 10, 0, 50) -- Pozycja pod linią, z lewej
sidebarFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25) -- Nieco inny odcień tła
sidebarFrame.BorderSizePixel = 0
sidebarFrame.Parent = mainFrame

local sidebarCorner = Instance.new("UICorner")
sidebarCorner.CornerRadius = UDim.new(0, 8)
sidebarCorner.Parent = sidebarFrame

local sidebarLayout = Instance.new("UIListLayout")
sidebarLayout.Padding = UDim.new(0, 5)
sidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
sidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
sidebarLayout.Parent = sidebarFrame

-- Główny kontener na przyciski (z prawej strony)
local contentFrame = Instance.new("ScrollingFrame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, -150, 1, -70) -- Szerokość (całość - sidebar - marginesy), wysokość
contentFrame.Position = UDim2.new(0, 140, 0, 50) -- Pozycja obok sidebara
contentFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25) -- Taki sam jak sidebar dla spójności
contentFrame.BorderSizePixel = 0
contentFrame.ScrollingDirection = Enum.ScrollingDirection.Y
contentFrame.ScrollBarThickness = 6
contentFrame.ScrollBarImageColor3 = Color3.fromRGB(60, 60, 75)
contentFrame.CanvasSize = UDim2.new(0, 0, 0, 0) -- Początkowo zero, dynamicznie zmieniane
contentFrame.Parent = mainFrame

local contentCorner = Instance.new("UICorner")
contentCorner.CornerRadius = UDim.new(0, 8)
contentCorner.Parent = contentFrame

local contentLayout = Instance.new("UIListLayout")
contentLayout.Padding = UDim.new(0, 8)
contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
contentLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
contentLayout.Parent = contentFrame


-------------------------------------------------------------------------------
--  2. Перетаскивание окна (mainFrame) при удержании ЛКМ (Oryginalny komentarz)
--     (Przeciąganie okna - Wersja z ograniczeniem do górnej belki)
-------------------------------------------------------------------------------
do
    local dragging = false
    local dragInput = nil
    local dragStart = nil
    local startPos = nil

    local function update(input)
        local delta = input.Position - dragStart
        local newX = startPos.X.Offset + delta.X
        local newY = startPos.Y.Offset + delta.Y
        mainFrame.Position = UDim2.new(startPos.X.Scale, newX, startPos.Y.Scale, newY)
    end

    mainFrame.InputBegan:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            local absPos = mainFrame.AbsolutePosition
            local absSize = mainFrame.AbsoluteSize
            local headerHeight = 45 -- Wysokość obszaru przeciągania (belka tytułowa)

            -- Sprawdź, czy kliknięcie jest w obszarze nagłówka
            if input.Position.Y < absPos.Y + headerHeight and input.Position.Y > absPos.Y and input.Position.X > absPos.X and input.Position.X < absPos.X + absSize.X then
                dragging = true
                dragStart = input.Position
                startPos = mainFrame.Position

                -- Śledź zmianę stanu inputu (puszczenie przycisku)
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        dragging = false
                    end
                end)
            end
        end
    end)

    mainFrame.InputChanged:Connect(function(input)
        -- Aktualizuj referencję do inputu, jeśli to ruch myszki lub dotyk
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        -- Jeśli przeciągamy i zarejestrowany input się zmienił, zaktualizuj pozycję
        if input == dragInput and dragging then
            update(input)
        end
    end)
end


-------------------------------------------------------------------------------
--  3. Клавиша [K] для показа/скрытия (Oryginalny komentarz)
--     (Klawisz [K] do Pokazania/Ukrycia)
-------------------------------------------------------------------------------
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    -- Jeśli gra nie przechwyciła inputu (np. pisanie na czacie)
    if not gameProcessedEvent then
        -- I jeśli wciśnięto klawisz K
        if input.KeyCode == Enum.KeyCode.K then
            -- Przełącz widoczność głównego okna
            mainFrame.Visible = not mainFrame.Visible
        end
    end
end)

-------------------------------------------------------------------------------
-- Block for: Bread Collector (Reworked Auto Pickup Money)
-------------------------------------------------------------------------------

local Collector_Enabled = false
local Collector_Signal = nil
local Collector_Task = nil

local function Collector_CoreLogic()
	local RS_S = game:GetService("RunService")
	local RS_Rep = game:GetService("ReplicatedStorage")
	local WS = game:GetService("Workspace")

	local function RunCollectorLogic()
		if not Collector_Enabled or Settings.IsDead then return end

		local breadContainer = WS.Filter:FindFirstChild("SpawnedBread")
		local pickupRemote = RS_Rep.Events:FindFirstChild("CZDPZUS")

		if not breadContainer then
			warn("BreadCollector: SpawnedBread folder missing. Pausing pickup logic.")
			return
		end
		if not pickupRemote then
			warn("BreadCollector: Pickup RemoteEvent missing. Pausing pickup logic.")
			return
		end

		local p_char = localPlayer.Character
		local root_part = p_char and p_char:FindFirstChild("HumanoidRootPart")

		if not root_part or CoolDowns.AutoPickUps.MoneyCooldown then return end

		local current_pos = root_part.Position
		for _, item in ipairs(breadContainer:GetChildren()) do
			local dist_sq = (current_pos - item.Position).Magnitude^2
			if dist_sq < 25 and not CoolDowns.AutoPickUps.MoneyCooldown then
				CoolDowns.AutoPickUps.MoneyCooldown = true
				
				pcall(function()
					pickupRemote:FireServer(item)
				end)
				
				task.wait(1.1)
				
				CoolDowns.AutoPickUps.MoneyCooldown = false
				break
			end
		end
	end

	Collector_Signal = RS_S.RenderStepped:Connect(RunCollectorLogic)
end

local function Collector_Activate()
	if Collector_Enabled then return end
	Collector_Enabled = true

	if Collector_Signal then
		Collector_Signal:Disconnect()
		Collector_Signal = nil
	end
	if Collector_Task then
		coroutine.close(Collector_Task)
		Collector_Task = nil
	end

	Collector_CoreLogic()
end

local function Collector_Deactivate()
	if not Collector_Enabled then return end
	Collector_Enabled = false

	if Collector_Signal then
		Collector_Signal:Disconnect()
		Collector_Signal = nil
	end

	if CoolDowns and CoolDowns.AutoPickUps then
		CoolDowns.AutoPickUps.MoneyCooldown = false
	end
end

-- Main function to enable the autofarm and invisibility
local function Autofarm_Enable()
	if autofarmEnabled then return end
	autofarmEnabled = true
	
	_G.ActivateShadow() -- Użycie nowej nazwy
	Collector_Activate() -- Użycie nowej nazwy
	--Noclip_Enable() -- Włącz Noclip
end

-- Main function to disable the autofarm and invisibility
local function Autofarm_Disable()
	if not autofarmEnabled then return end
	autofarmEnabled = false
	
	_G.DeactivateShadow() -- Użycie nowej nazwy
	Collector_Deactivate() -- Użycie nowej nazwy
	--Noclip_Disable() -- Wyłącz Noclip
end

-- NOWA, WZMOCNIONA LOGIKA RESPONSU
task.spawn(function()
	local deathRespawnEvent = services.rs_rep:WaitForChild("Events"):WaitForChild("DeathRespawn")
	while task.wait() do
		local char = localPlayer.Character
		if char then
			local humanoid = char:FindFirstChildOfClass("Humanoid")
			if humanoid and humanoid.Health <= 0 and autofarmEnabled then
				deathRespawnEvent:InvokeServer("KMG4R904")
				task.wait(2) -- Dłuższe oczekiwanie na pełny respawn
			end
		end
	end
end)


-- Handle character respawn and script resume
localPlayer.CharacterAdded:Connect(function(character)
	if not autofarmEnabled then
		return
	end

	-- Dłuższe oczekiwanie na pełne załadowanie postaci i elementów gry
	character:WaitForChild("HumanoidRootPart", 5)
	task.wait(1.5)

	-- TWARDY RESET STANU LOKALNEGO
	autofarmCooldown = false
	ignoredSafes = {}
	
	-- Wymuś ponowną aktywację, aby zsynchronizować stan ze skryptami
	Autofarm_Enable()
end)

-------------------------------------------------------------------------------
-- 2. METODY (Funkcje operujące na UI)
-------------------------------------------------------------------------------

--- Przełącza widoczną kategorię w interfejsie.
function EQR_UI:SwitchCategory(categoryName)
    local categoryButton = self.CategoryButtons[categoryName]
    if not categoryButton or categoryButton == self.ActiveCategoryButton then
        return
    end

    -- Zresetuj poprzedni aktywny przycisk
    if self.ActiveCategoryButton then
        TweenService:Create(self.ActiveCategoryButton, TweenInfo.new(0.2), { BackgroundColor3 = Color3.fromRGB(20, 20, 25) }):Play()
        self.ActiveCategoryButton.TextLabel.TextColor3 = Color3.fromRGB(180, 180, 190)
    end

    -- Ustaw nowy aktywny przycisk
    TweenService:Create(categoryButton, TweenInfo.new(0.2), { BackgroundColor3 = Color3.fromRGB(40, 40, 50) }):Play()
    categoryButton.TextLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
    self.ActiveCategoryButton = categoryButton

    -- Wyczyść contentFrame
    for _, child in ipairs(contentFrame:GetChildren()) do
        if child:IsA("Frame") and child.Name ~= "UIListLayout" and child.Name ~= "UICorner" then
            child.Parent = nil
        end
    end

    -- Dodaj ramki z nowej kategorii
    if self.CategoryFrames[categoryName] then
        for i, frame in ipairs(self.CategoryFrames[categoryName]) do
            frame.Parent = contentFrame
            frame.LayoutOrder = i
        end
        -- Zaktualizuj CanvasSize dla przewijania
        local numItems = #self.CategoryFrames[categoryName]
        local itemHeight = 35
        local padding = contentLayout.Padding.Offset
        contentFrame.CanvasSize = UDim2.new(0, 0, 0, numItems * itemHeight + (numItems > 0 and (numItems - 1) * padding or 0) + 10)
    else
        contentFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    end
end

--- Obsługuje zdarzenie InputBegan dla keybindów.
function EQR_UI:OnInputBegan(input, gameProcessedEvent)
    if gameProcessedEvent then return end

    local keyCode = input.KeyCode
    if keyCode == Enum.KeyCode.Unknown then return end

    -- Obsługa ustawiania nowego binda
    if currentRowWaitingForKey then
        local frame = currentRowWaitingForKey
        local bindButton = bindButtonReferences[frame]
        local getKeyFn = keyBindGetters[frame]
        local setKeyFn = keyBindSetters[frame]
        local frameData = rowFunctionData[frame]

        if bindButton and getKeyFn and setKeyFn and frameData then
            local oldKey = nil
            local successGet, resultGet = pcall(getKeyFn)
            if successGet then oldKey = resultGet end

            if oldKey and activeBinds[oldKey] and activeBinds[oldKey].frame == frame then
                activeBinds[oldKey] = nil
            end

            if activeBinds[keyCode] and activeBinds[keyCode].frame ~= frame then
                local otherFrame = activeBinds[keyCode].frame
                local otherBindButton = bindButtonReferences[otherFrame]
                local otherSetKeyFn = keyBindSetters[otherFrame]
                if otherSetKeyFn then pcall(otherSetKeyFn, nil) end
                if otherBindButton then otherBindButton.Text = "Bind" end
                activeBinds[keyCode] = nil
            end

            pcall(setKeyFn, keyCode)

            local toggleButton
            for _, child in ipairs(frame:GetChildren()) do if child:IsA("TextButton") and child ~= bindButton then toggleButton = child; break end end

            if toggleButton then
                activeBinds[keyCode] = {
                    frame = frame,
                    toggleButton = toggleButton,
                    isEnabledFn = frameData.isEnabledFn,
                    onEnable = frameData.onEnable,
                    onDisable = frameData.onDisable,
                    canToggle = frameData.canToggle,
                    updateFn = frameData.updateFn
                }
            else
                warn("Nie można znaleźć przycisku przełącznika dla ramki:", frame.Name)
            end

            bindButton.Text = "[" .. input.KeyCode.Name .. "]"
            currentRowWaitingForKey = nil
        else
            if bindButton then bindButton.Text = "Bind" end
            currentRowWaitingForKey = nil
            warn("Błąd podczas przechwytywania klawisza - brakujące funkcje/referencje dla ramki:", frame and frame.Name or "Unknown")
        end

    -- Obsługa aktywacji istniejącego binda
    elseif activeBinds[keyCode] then
        local bindInfo = activeBinds[keyCode]
        if bindInfo.frame and bindInfo.isEnabledFn and bindInfo.onEnable and bindInfo.onDisable and bindInfo.updateFn and bindInfo.canToggle ~= nil then
            if bindInfo.canToggle then
                local success, currentState = pcall(bindInfo.isEnabledFn)
                if success then
                    if currentState then
                        pcall(bindInfo.onDisable)
                    else
                        pcall(bindInfo.onEnable)
                    end
                    task.wait()
                    pcall(bindInfo.updateFn)
                end
            end
        end
    end
end

--- Inicjalizuje UI, tworzy wszystkie elementy i łączy zdarzenia.
function EQR_UI:Initialize()
    -- 6. Tworzenie Przycisków Kategorii
    for i, categoryName in ipairs(self.Categories) do
        self.CategoryFrames[categoryName] = {}

        local catButton = Instance.new("TextButton")
        catButton.Name = categoryName .. "Button"
        catButton.Size = UDim2.new(1, -10, 0, 30)
        catButton.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
        catButton.BorderSizePixel = 0
        catButton.AutoButtonColor = false
        catButton.LayoutOrder = i
        catButton.Parent = sidebarFrame

        local catCorner = Instance.new("UICorner")
        catCorner.CornerRadius = UDim.new(0, 6)
        catCorner.Parent = catButton

        local catLabel = Instance.new("TextLabel")
        catLabel.Name = "TextLabel"
        catLabel.Size = UDim2.new(1, 0, 1, 0)
        catLabel.BackgroundTransparency = 1
        catLabel.Text = categoryName
        catLabel.Font = Enum.Font.GothamSemibold
        catLabel.TextSize = 14
        catLabel.TextColor3 = Color3.fromRGB(180, 180, 190)
        catLabel.Parent = catButton

        catButton.MouseEnter:Connect(function()
            if catButton ~= self.ActiveCategoryButton then
                TweenService:Create(catButton, TweenInfo.new(0.1), { BackgroundColor3 = Color3.fromRGB(30, 30, 35) }):Play()
            end
        end)
        catButton.MouseLeave:Connect(function()
            if catButton ~= self.ActiveCategoryButton then
                TweenService:Create(catButton, TweenInfo.new(0.1), { BackgroundColor3 = Color3.fromRGB(20, 20, 25) }):Play()
            end
        end)
        catButton.MouseButton1Click:Connect(function()
            self:SwitchCategory(categoryName)
        end)

        self.CategoryButtons[categoryName] = catButton
    end

    -- 7. Tworzenie Ramek dla Funkcji i Dodawanie do Kategorii
    local k = self.KeyBinds -- Skrót dla łatwiejszego dostępu

    -- Combat
    table.insert(self.CategoryFrames.Combat, createToggleRowFrame("Melee Aura", true, function() return MeleeAura_Enabled end, MeleeAura_Enable, MeleeAura_Disable, function() return k.melee end, function(val) k.melee=val end))
    table.insert(self.CategoryFrames.Combat, createToggleRowFrame("Aimbot", true, function() return AimBotSettings.Enabled end, Aimbot_Enable, Aimbot_Disable, function() return k.aimbot end, function(val) k.aimbot=val; AimBotSettings.Keybind=val end))
    table.insert(self.CategoryFrames.Combat, createToggleRowFrame("No Recoil", true, function() return NoRecoil_Enabled end, NoRecoil_Enable, NoRecoil_Disable, function() return k.noRecoil end, function(val) k.noRecoil=val end))

    -- Movement
    table.insert(self.CategoryFrames.Movement, createToggleRowFrame("Fly", true, function() return Fly_Enabled end, Fly_Enable, Fly_Disable, function() return k.fly end, function(val) k.fly=val; Fly_Bind=val end))
    table.insert(self.CategoryFrames.Movement, createToggleRowFrame("Noclip", true, function() return Noclip_Enabled end, Noclip_Enable, Noclip_Disable, function() return k.noclip end, function(val) k.noclip=val; Noclip_Bind=val end))
    table.insert(self.CategoryFrames.Movement, createToggleRowFrame("Infinite Stamina", true, function() return isInfiniteStaminaEnabled end, InfiniteStamina_Enable, InfiniteStamina_Disable, function() return k.infiniteStamina end, function(val) k.infiniteStamina=val end))

    -- Visuals
    table.insert(self.CategoryFrames.Visuals, createToggleRowFrame("ESP (55 STUDS)", true, function() return ESP_Enabled end, ESP_Enable, ESP_Disable, function() return k.esp end, function(val) k.esp=val end))
    table.insert(self.CategoryFrames.Visuals, createToggleRowFrame("Invisibility", true, _G.IsInvisEnabled, _G.Invis_Enable, _G.Invis_Disable, function() return k.invis end, function(val) k.invis=val end))
    table.insert(self.CategoryFrames.Visuals, createToggleRowFrame("Safe ESP", true, function() return BredMakurz_Enabled end, BredMakurz_Enable, BredMakurz_Disable, function() return k.safeESP end, function(val) k.safeESP=val end))
    table.insert(self.CategoryFrames.Visuals, createToggleRowFrame("FullBright", true, function() return FullBright_Enabled end, FullBright_Enable, FullBright_Disable, function() return k.FullBright end, function(val) k.FullBright=val; FulLBright_Bind=val end))
    table.insert(self.CategoryFrames.Visuals, createToggleRowFrame("FOV", true, function() return Fov_Enabled end, Fov_Enable, Fov_Disable, function() return k.fov end, function(val) k.fov=val; fov=val end))

    -- Farming
    table.insert(self.CategoryFrames.Farming, createToggleRowFrame("Autofarm", true, function() return autofarmEnabled end, Autofarm_Enable, Autofarm_Disable, function() return k.autofarm end, function(val) k.autofarm=val; Autofarm_Bind=val end))
    
    -- Misc
    --table.insert(self.CategoryFrames.Misc, createToggleRowFrame(" Anti AFK", true, function() return AntiAFK_Enabled_Dummy end, AntiAFK_Enable, AntiAFK_Disable, function() return k.antiAFK end, function(val) k.antiAFK=val end))
    table.insert(self.CategoryFrames.Misc, createToggleRowFrame("Staff Detector", true, function() return AdminCheck_Enabled end, AdminCheck_Enable, AdminCheck_Disable, function() return k.adminCheck end, function(val) k.adminCheck=val end))
    table.insert(self.CategoryFrames.Misc, createToggleRowFrame("Auto Pickup Money", true, function() return AutoPickupMoney_Enabled end, AutoPickupMoney_Enable, AutoPickupMoney_Disable, function() return k.autoPickupMoney end, function(val) k.autoPickupMoney=val end))
    table.insert(self.CategoryFrames.Misc, createToggleRowFrame("No Fail Lockpick", true, function() return NoFailLockpick_Enabled end, NoFailLockpick_Enable, NoFailLockpick_Disable, function() return k.noFailLockpick end, function(val) k.noFailLockpick=val end))
    table.insert(self.CategoryFrames.Misc, createToggleRowFrame("Auto Unlock Doors", true, function() return UnlockNearbyDoors_Enabled end, UnlockNearbyDoors_Enable, UnlockNearbyDoors_Disable, function() return k.unlockNearbyDoors end, function(val) k.unlockNearbyDoors=val end))
    table.insert(self.CategoryFrames.Misc, createToggleRowFrame("Auto Open Doors", true, function() return OpenNearbyDoors_Enabled end, OpenNearbyDoors_Enable, OpenNearbyDoors_Disable, function() return k.openNearbyDoors end, function(val) k.openNearbyDoors=val end))

    -- Rage
    table.insert(self.CategoryFrames.Rage, createToggleRowFrame("Ragebot", true, function() return Ragebot_Enabled end, Ragebot_Enable, Ragebot_Disable, function() return k.ragebot end, function(val) k.ragebot=val end))
    
    -- 8. Podłączenie Globalnych Listenerów
    UserInputService.InputBegan:Connect(function(...) self:OnInputBegan(...) end)
    PlayerGui.ChildAdded:Connect(function(Item)
        if Item.Name == "LockpickGUI" then
            ApplyLockpickModification()
        end
    end)
    
    -- 9. Ustawienie Domyślnej Kategorii i Animacja Otwierania
    self:SwitchCategory(self.DefaultCategory)
    
    mainFrame.Size = UDim2.new(0, 0, 0, 0)
    local openTween = TweenService:Create(mainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), { Size = UDim2.new(0, 450, 0, 350) })
    task.wait(0.1)
    openTween:Play()
    
    print("EQR Hub (Refactored UI - Final) Loaded.")
end

-------------------------------------------------------------------------------
-- 3. URUCHOMIENIE
-------------------------------------------------------------------------------
EQR_UI:Initialize()
